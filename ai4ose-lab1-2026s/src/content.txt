# AI4OSE实验一
2026.02.09

From: 碳基智能+硅基智能=碳硅智能

## 一、引言

学生在当前操作系统内核的学习中，常见的现象是大家听同一个老师上课，看同一本教材，参加同样的应试考试，缺少老师的一对一的指导。常见的问题是原理与实践脱节，缺少对知识点的全局理解，缺少历史发展的脉络，不知道操作系统内核是如何一步一步发展起来的，忽视硬件细节和软件架构设计。这些现存问题增加了学生学习和掌握操作系统内核的难度。另外一方面，现在AI辅助编程和AI问答的快速演进，对操作系统内核的教学和操作系统内核工程（Operating System Engineering, OSE）也形成了机遇与挑战。
为此，我们希望对操作系统内核的学习进行一定的调整，来帮助学生更有效地找到一个最适合自己的学习操作系统内核的方法，并进一步探索操作系统内核工程化开发的方法。

我们的看法是：当一个学生学完操作系统内核这门课后，能给其他学生传授知识（1：理解知识），并开发操作系统内核（2：运用知识），1+2=知行合一，那他就算是"懂"了操作系统内核这门课了。

## 二、目标
总体目标：与AI（硅基智能）合作，自己高效完成对操作系统内核课的学习，并推动自己的学习成果帮助更多的学生高效学习操作系统内核。
具体目标：与AI合作，参考最新的操作系统内核课程的组件化实验代码（持续更新）和附录中的可使用资源，设计一套适合自己学习的教学实验环境（包含实验指导文档、实验代码、测试用例/实验答案、文字类习题/文字类答案）。即做到自己只需基于自己写出的实验指导文档、实验代码、测试用例进行学习，就可以"懂"操作系统内核了。

## 三、要求
1. 目前提供的"可使用资源"是超量的，并不需要全部学习，也不一定适合每位同学。你需要构建适合你自己或与你类似的学生特点的教学实验环境，这个过程听起来很复杂，但我们鼓励你借助AI的帮助完成。即，通过自己即当学生也当老师，来完成整个实验。
2. 操作系统内核编程语言为 Rust，硬件环境是RISC-V 64，在QEMU模拟器上运行。具体可参考下面附录中的 “最新教学实验环境”。我们还要求基于Rust Crate组件化编程，且每个内核主体（执行程序）或内核模块（库）能通过单元测试和系统测试，且可以独立发布到crates.io上。具体可查阅 cargo publish 命令相关文档。
3. 文档格式是markdown格式，可以用 mermaid 等方式来画图。
4. 要求把自己设计的教学实验环境放到公开的git仓库（国内外都行，尽量便于访问）。写的不完善没关系，可以快速更新迭代，让老师和其他同学都可以看到，并给出建议。
5. 不限制AI工具，要求尽可能地充分地与各种AI工具合作，但也必须要能从中提高自己的学习能力和技能。我们会在你进展到一定的阶段，给你提供你能驾驭的AI工具帮助你高效学习（注：由于涉及费用，“提供AI工具”不是一定能满足的事情）。
6. 每周写出周学习进展纪要，并把与各种AI工具交流讨论的内容，按时间顺序保存，都放在自己的git仓库中。我们也鼓励你与其他同学和老师交流。

## 四、考核
给yuchen@tsinghua.edu.cn发电子邮件，标题是[AI4OSE-lab1-2026s passed]-姓名+学校名，邮件内容是你的仓库链接和其他你认为代表你通过了学习的重要信息（如与我们提供的教学实验环境参考仓库进行对比分析，说明为何你的设计更合适；修改或增添了适合你的实验或文档内容等）。
通过如下检查评审：
 1. 完成在附录中的“最新教学实验环境”中的5个基础实验练习（评分占比：20%）
 2. 完成一个适合自己的教学实验环境（可以与附录中的“最新教学实验环境”不同，但要体现出适合你的特点，并给出效率评估和明确的对比分析）（评分占比：40%）
 3. 通过面试：判断你是否已掌握操作系统内核的原理概念并具备一定的实践能力（评分占比：40%）
 
得到80分以上（百分制，满分100分）算通过，我们会通过电子邮件发通过验证信息。

我们会将通过验证的优秀实验成果发布到crates.io、https://github.com/learningos，并推荐给opencamp的开源操作系统训练营，让更多人选择并学习适合他们特点的优秀实验成果而受益。

注：如没有特别的想法，可以基于附录中的最新的OS课组件化实验代码，进行改进、扩展、裁剪、重构，并添加相关文档，形成一套适合自己学习的操作系统内核教学实验环境。

## 考核完成情况

### 1. 基础实验完成情况（评分占比：20%）

基于参考仓库 rCore-Tutorial-in-single-workspace (test分支) 完成了5个基础实验，均在 QEMU (RISC-V 64) 上成功编译运行。

#### Ch1: 应用程序与基本执行环境
- 核心知识点：裸机编程（#![no_std]/#![no_main]）、SBI接口、RISC-V S态/M态特权级、链接脚本与内存布局
- 实现内容：最小裸机程序，通过SBI console_putchar逐字符输出，通过shutdown关机
- 运行结果：成功输出 "Hello, world!"
- 关键代码：naked函数_start设置栈指针(sp=0x80204000)后跳转rust_main，M态入口0x80000000，S态入口0x80200000

#### Ch2: 批处理系统
- 核心知识点：特权级切换（U态/S态）、Trap处理机制、系统调用、批处理加载
- 实现内容：批处理内核顺序加载并执行用户程序（app0-app7），处理非法指令/存储异常
- 运行结果：成功运行8个用户程序，包括hello_world、store_fault（触发StoreFault被内核杀死）、power计算、特权指令测试（触发IllegalInstruction被内核杀死）
- 关键组件：tg-sbi、tg-kernel-context（上下文切换）、tg-syscall（系统调用定义）

#### Ch3: 多道程序与分时多任务
- 核心知识点：多道程序加载、协作式/抢占式调度、时间片轮转、定时器中断
- 实现内容：同时加载12个应用到不同内存区域（0x80400000起，每个间隔0x200000），通过时间片调度并发执行
- 运行结果：成功观察到多任务交替执行（AAAA/BBBB/CCCC交替输出），sleep测试和power计算均通过
- 关键观察：任务切换效果明显，A任务分5次完成，B任务分2次，C任务分3次，三者交替执行

#### Ch4: 地址空间
- 核心知识点：SV39页表机制、虚拟内存映射、用户/内核地址空间隔离、sbrk内存管理
- 实现内容：为每个进程创建独立页表，内核映射(.text/.rodata/.data/.bss)，用户程序通过ELF加载到虚拟地址空间
- 运行结果：成功运行13个应用，sbrk测试验证了页面分配(break 0x20000->0x21000->0x2b000)和释放(->0x20000)，释放后写入触发StorePageFault
- 内存布局：.text 0x80200000..0x80217000, .rodata 0x80217000..0x80220000, heap 0x812d0000..0x81a00000

#### Ch5: 进程管理
- 核心知识点：进程抽象、fork/exec/waitpid系统调用、进程调度、用户Shell
- 实现内容：完整进程管理系统，支持进程创建（fork）、程序加载（exec）、进程等待（waitpid）
- 运行结果：成功启动用户Shell（"Rust user shell >>"），可交互执行用户程序
- 关键组件：tg-task-manage（进程管理）、tg-kernel-vm（虚拟内存）、tg-kernel-context（上下文）
- 内存布局：.text 0x80200000..0x8022b000, heap 0x81d98000..0x83200000

实验仓库：https://github.com/JerryHanjr/AI4OSE
参考仓库：https://github.com/rcore-os/rCore-Tutorial-in-single-workspace/tree/test

### 2. 自定义教学实验环境（评分占比：40%）

仓库地址：https://github.com/JerryHanjr/AI4OSE

设计特点（与参考仓库的区别）：
- AI驱动的学习路径：结合AI工具（Claude Code）辅助理解每个实验的核心概念，快速定位问题
- 渐进式实验记录：从Ch1裸机到Ch5进程管理，每步记录核心知识点、运行结果、关键代码分析
- 组件化架构理解：基于tg-*系列Crate（tg-sbi/tg-kernel-context/tg-kernel-vm/tg-task-manage等）理解模块化OS设计

对比分析（与参考仓库 rCore-Tutorial-in-single-workspace）：
- 学习路径：参考仓库提供完整代码直接运行，本环境强调"理解每行代码为什么这么写"的AI辅助分析
- 文档形式：参考仓库文档偏向代码注释，本环境补充了运行结果分析和知识点总结
- 实验验证：参考仓库通过CI自动测试，本环境通过手动运行+AI辅助分析验证理解程度

效率评估：
- 通过AI辅助，快速理解了裸机启动流程（链接脚本、内存布局、SBI接口）
- AI帮助解释了RISC-V特权级机制（M/S/U态切换）和Trap处理流程
- 组件化设计（tg-*模块）降低了理解复杂度，可单独研究每个模块

### 3. 个人思考与学习总结

对OS内核的理解：
- 操作系统内核本质是硬件资源的抽象层，RISC-V通过M/S/U三个特权级实现安全隔离
- 从Ch1到Ch5的演进体现了OS发展历程：裸机->批处理->多任务->虚拟内存->进程，每步解决一个核心问题
- SV39页表机制将物理地址空间转化为进程独立的虚拟地址空间，是现代OS最重要的抽象
- fork/exec模型体现了Unix哲学：fork复制，exec替换，简洁而强大

AI协作体验：
- AI在代码理解和概念解释方面表现出色，能快速解答Rust no_std编程和RISC-V架构问题
- 在调试底层硬件相关问题时（如链接脚本、内存布局），AI提供了关键的背景知识
- "碳硅智能"协作模式让学习效率显著提升，但核心理解仍需个人思考沉淀

## 五、劝退
1. 已经懂操作系统内核的人
2. 非主动想学习操作系统内核的人
3. 只有想法但缺少持续执行力的人

## 附录：可使用的资源：
- 最新教学实验环境--最新的OS课组件化实验代码和对应的实验指导文档（都在持续更新）：https://github.com/rcore-os/rCore-Tutorial-in-single-workspace/tree/test
可作为你与AI合作完成的适合自己学习的教学实验环境的一个参考仓库（也是对比对象）。

课程：
- OS课程在线讲义：https://learningos.cn/os-lectures/
- OS课程讲义列表： https://www.yuque.com/xyong-9fuoz/qczol5/glemuu?
- OS课程讲义源文件仓库：https://github.com/LearningOS/os-lectures

参考书：
- OS课教材参考书：https://pages.cs.wisc.edu/~remzi/OSTEP/Chinese/
- 深入了解计算机系统教材参考书：https://hansimov.gitbook.io/csapp/
- RISC-V Reader中文版：http://riscvbook.com/chinese/RISC-V-Reader-Chinese-v2p1.pdf

实验：
- rCore-Tutorial Book: https://rcore-os.cn/rCore-Tutorial-Book-v3/
- 实验代码：https://github.com/LearningOS/rCore-Tutorial-Code/
- 实验指导文档：https://learningos.github.io/rCore-Tutorial-Guide/
- 测试用例：https://github.com/LearningOS/rCore-Tutorial-Test/

训练营：
- 2025年秋冬季开源操作系统训练营：https://opencamp.cn/os2edu/camp/2025fall

注：上述可用资源是清华大学计算机系本科OS课学生学习所用的几乎所有资源（缺历年考试试卷、课后练习、上课视频）